<html>
  <head>
    <script src="https://unpkg.com/react@17/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.0/axios.min.js" integrity="sha512-bPh3uwgU5qEMipS/VOmRqynnMXGGSRv+72H/N260MQeXZIK4PG48401Bsby9Nq5P5fz7hy5UGNmC/W1Z51h2GQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  </head>
  <body>
    <div id='root'></div>
    <script type='text/babel'>

        const Name = (props) => {
            //props is an object containing a key "game" (line 47) and the value is an object with a row in our table 
            const game = props.game
            //this gives us an object that represents a row in our table
            return (
                <li onClick = {() => props.selectGame(game.id)}>
                    {game.name} is a {game.genre} game <button>x</button>
                </li>
            )
        }

        const OneGame = (props)=>{
            const game = props.selectedGame
            return(
                <div>
                    {game.name} is a {game.genre} game  
                </div>
            )
        }

        class Game extends React.Component{
            constructor(){
                super()
                this.state = {
                    games:[],
                    selectedGame: {}
                }
                this.selectGame = this.selectGame.bind(this)
            }

            async selectGame(gameId){
                try{
                    const response = await axios.get(`/api/games/${gameId}`)
                    const data = response.data
                    this.setState({selectedGame:data})
                }catch(err){
                    console.log('there was an error selecting a game')
                }
            }

            //we use componentDidMount to do async calls to get data from database using axios
            async componentDidMount(){
                const response = await axios.get('/api/games')
                const data = response.data
                //data is an array of objects, where each object is a row on our table i.e. the id, name, genre, createdAt, updatedAt
                this.setState({games:data})
                //this.state.games' value is data, this.state is an object containing games as a key and the key:value is data
            }
            
            //render gets called EVERY time the state changes.
            render(){
                if(this.state.selectedGame.id){
                    return (
                        <div>
                            <h1>{this.state.selectedGame.name}</h1>
                            <h3>
                                <OneGame selectedGame = {this.state.selectedGame}/> 
                            </h3>
                        </div>
                    )
                }else{
                    return (
                    <div>
                        <h1>Games</h1>

                        {/*We map through an array of games (our this.state.games), Name is referring to a function that we created above on line 12*/}
                        {this.state.games.map(game /*(1)*/=> {
                            return (
                                <Name 
                                game={game/* first game is what we call the key in props, second game refers to game above - (1)*/}
                                selectGame = {this.selectGame}
                                />
                            )
                        })} 
                        <form method = 'POST'>
                            <input/>
                            <button type = 'submit'>add game</button> 
                        </form>
                    </div>
                )
                }
            }
        }

      const root = document.querySelector('#root');
      ReactDOM.render(<Game/>, root);
    </script>
  </body>
</html>