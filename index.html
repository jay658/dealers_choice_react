<html>
  <head>
    <script src="https://unpkg.com/react@17/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.0/axios.min.js" integrity="sha512-bPh3uwgU5qEMipS/VOmRqynnMXGGSRv+72H/N260MQeXZIK4PG48401Bsby9Nq5P5fz7hy5UGNmC/W1Z51h2GQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  </head>
  <body>
    <div id='root'></div>
    <script type='text/babel'>

        const GameList = (props) => {
            const games = props.games
            console.log(props)
            return (
                games.map(game=>{
                    return(
                        <div>
                            <li onClick = {() => props.selectGame(game.id)}>
                                {game.name} is a {game.genre} game 
                            </li>
                            <button onClick = {()=> props.deleteGame(game)}>x</button>
                        </div>
                    )
                })
            )
        }

        const OneGame = (props)=>{
            const game = props.selectedGame
            return(
                <div>
                    {game.name} is a {game.genre} game 
                    <div> </div>
                    <div onClick = {()=> props.reset()}>Go back</div>
                </div>
            )
        }

        class Game extends React.Component{
            constructor(){
                super()
                this.state = {
                    games:[],
                    selectedGame: {}
                }
                this.selectGame = this.selectGame.bind(this)
                this.deleteGame = this.deleteGame.bind(this)
                this.reset = this.reset.bind(this)
            }

            reset(){
                this.setState({ selectedGame: {}})
            }

            async deleteGame(deletedGame){
                try{
                    await axios.delete(`/api/games/${deletedGame.id}`)
                    const games = this.state.games.filter(game => game.id !== deletedGame.id)
                    this.setState({games})
                }catch(err){
                    console.log('there was an error deleting a game')
                }
            }

            async selectGame(gameId){
                try{
                    const response = await axios.get(`/api/games/${gameId}`)
                    const data = response.data
                    this.setState({selectedGame:data})
                }catch(err){
                    console.log('there was an error selecting a game')
                }
            }

            //we use componentDidMount to do async calls to get data from database using axios
            async componentDidMount(){
                const response = await axios.get('/api/games')
                const data = response.data
                this.setState({games:data})
            }
            
            //render gets called EVERY time the state changes.
            render(){
                const games = this.state.games
                const selectedGame = this.state.selectedGame
                if(selectedGame.id){
                    return (
                        <div>
                            <h1>{selectedGame.name}</h1>
                            <h3>
                                <OneGame selectedGame = {selectedGame} reset={this.reset}/> 
                            </h3>
                        </div>
                    )
                }else{
                    return (
                    <div>
                        <h1>Games</h1>
                            <GameList games = {games} selectGame = {this.selectGame} deleteGame = {this.deleteGame}/>
                    </div>
                )
                }
            }
        }

      const root = document.querySelector('#root');
      ReactDOM.render(<Game/>, root);
    </script>
  </body>
</html>